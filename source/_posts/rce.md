---
title: rce
date: 2022-01-08 11:08:34
tags:
      - RCE
      - php
categories: web
---

### PHP常见的命令执行函数和运算符<!--more-->

##### 1.system()函数

用于执行外部程序,并且显示输出

system('whoami')

root

##### 2.exec函数

用于执行一个外部程序, 并不会自动输出,需要加echo

echo exec('whoami')

root

##### 3.shell_exec函数

通过shell环境执行命令,并且将完整的输出以字符串的方式返回,不会自动输出,需要加echo

echo shell_exec('whoami')

root

##### 4.passthru函数

用于执行外部程序并且显示原始输出

passthru('whoami')

root

##### 5.popen函数

popen函数用于打开进程文件指针,用法如下:

resource.popen(string $command,string $mode)

例如

popen("touch test.txt","r");执行该代码后,会在当前目录下创建text.txt文件

##### 6.proc_popen

用于执行一个命令,并且打开用来输入输出的文件指针.大概相当于popen的数组版

##### 7.反单引号

反单引号是PHP执行运算符,PHP将尝试将返单引号中的内容作为shell命令来执行,并将其输出信息返回

例如

echo \`whoami\`;

root

#### Windows下的命令连接符

##### 1)&命令连接符

&前面的语句为假,则直接执行&后面的语句,&前面的语句为真,则&前后的语句都执行

##### 2)&&命令连接符

&&前面的语句为假,则直接报错,&&后面的语句也不执行

##### 3)|命令连接符

|前面的语句为假,则直接报错,|后面的语句也不执行;

|前面的语句为真,则执行|后面的语句

##### 4)||命令连接符

||前面的语句为假,则执行||后面的语句;

||前面的语句为真,则只执行||前面的语句,不执行||后面的语句

#### linux下的命令连接符

##### 1);命令连接符

;使多个命令顺序执行,前面的命令和后面的命令都会执行

##### 2)&命令连接符

&的作用是使命令在后台运行,这样就可以同时执行多条命令

id&whoami前后命令都会执行

##### 3)&&命令连接符

&&的作用是:如果前面的命令执行成功,则执行后面的命令

##### 4)|命令连接符(管道符)

|的作用是:将前面的命令的输出作为后面的命令的输入,前面的命令和后面的命令都会执行,但是只显示后面的命令的执行效果.

##### 5||命令连接符

类似于if-else语句,前面执行后面不执行,前面执行失败后面执行

### 命令执行绕过

#### 1.绕过空格过滤

##### 1)${IFS}绕过

$IFS是shell的特殊环境变量,是linux下的内部域分隔符.${IFS}中存储的值可以是空格/制表符/换行符或者其他自定义符号

##### 2)$IFS$9绕过

##### 3)制表符绕过

%09是制表符的url编码,可以通过%09来代替空格,绕过空格过滤

##### 4){ }绕过

空格过滤可以用{ }绕过,例如

{cat,index.php}

##### 5)<绕过

例如cat<index.php

#### 2.绕过关键字过滤

**利用反引号绕过``包裹的内容在php中会被当成系统命令执行**

 

##### 1)变量拼接绕过

linux支持变量赋值,可以通过变量拼接来绕过过滤规则

例如

$a=c;$b=at;$a$b index.php

##### 2)空变量绕过

例如,可以通过空变量绕过cat命令过滤

ca${x}t index.php

##### 3)系统变量绕过

${SHELLOPTS}是系统变量,可以利用系统变量的字符拼接绕过过滤

 

##### 4)\绕过

可以通过c\a\t index.php绕过cat命令过滤

##### 5)通配符绕过(简单正则)

linux支持利用通配符进行字符匹配.通配符的作用是在模糊查询时表示文件名中某些不确定的字符

通配符规则如下:

- *表示0到多个任意字符
- ?代表一个任意字符
- [ ]内为字符范围,代表该字符范围中的任意一个字符

例如对于/etc/passwd可以使用/???/???sw?来绕过

##### 6)shell反弹绕过

##### 7)Base64编码绕过

利用系统函数base64对命令进行base64编码,以绕过过滤,例如,id命令的base64编码为aWQ=,再利用base64 -d对aWQ=进行解码,就绕过了过滤

```
echo "aWQ="|base64 -d
```

原理:利用echo和管道符向base64输入aWQ=,然后由base64 -d解码为id,再因外面包裹的``反引号,将id当命令执行

##### 8)利用expr和awk绕过

通过expr和awk命令从其他的文件中获取字符并进行命令构造

例如

 

##### 9)无回显的命令执行如果存在命令执行漏洞,但是没有回显,可以通过shell反弹的方式将shell反弹到vps上,然后通过vps执行命令.如果无法反弹shell,也可以通过 DNS管道解析的方式获取命令的执行结果

 

 
